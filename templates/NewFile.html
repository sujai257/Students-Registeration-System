<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Insert title here</title>
<link rel="stylesheet" href="{{url_for('static',filename='style.css')}}">
<link rel="stylesheet"
	href="{{url_for('static',filename='bootstrap.min.css')}}">
<style type="text/css">
body {
	margin-top: 5%;
	background: -webkit-linear-gradient(to bottom right, rgba(240, 147, 251, 1),
		rgba(245, 87, 108, 1));
	/* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
	background: linear-gradient(to bottom right, rgba(240, 147, 251, 1),
		rgba(245, 87, 108, 1));
	background-repeat: no-repeat;
	background-position: center;
	background-attachment: fixed;
}
</style>
</head>
<body>
	<center>
		<div>
			<a href="{{url_for('addrecord')}}">
				<button class="button button1" type="button">Add Student</button>
			</a>
		</div>
		<div class="mid">
			<table border="1">
				<tr>
					<th>ROLL_NO</th>
					<th>NAME</th>
					<th>AGE</th>
					<th>GENDER</th>
					<th>EMAIL_ID</th>
					<th>DEPARTMENT</th>
					<th>YEAR</th>
					<th>PH_NO</th>
					<th>EDIT</th>
					<th>DELETE</th>
				</tr>
				{% for d in data%}
				<tr>
					<th>{{d.roll_no}}</th>
					<th>{{d.name}}</th>
					<th>{{d.age}}</th>
					<th>{{d.gender}}</th>
					<th>{{d.email_id}}</th>
					<th>{{d.dept}}</th>
					<th>{{d.year}}</th>
					<th>{{d.ph_no}}</th>
					<th><a href="{{url_for('edit',roll=d.roll_no)}}"><buttonclass="button button2" type="button">Edit</button> </a></th>
					 <td><button class="button button2" type="button"data-roll="{{ d.roll_no }}" onclick="confirmDelete(this)">Remove</button></td> 
				</tr>
				{% endfor %}
			</table>
		</div>
	</center>
</body>
<script>
var success_message = "{{ success_message }}";
if (success_message) {
    alert(success_message);
}
function confirmDelete(button) {
    var s = prompt("Enter CONFIRM to delete:");
    if (s === "CONFIRM") {
        var rollNo = button.getAttribute("data-roll");
        var url = "/remove/" + rollNo;
        window.location.href = url;
    }
}
</script>
</html>


'''
Created on Mar 29, 2023

@author: sujai
'''
from flask import Flask,render_template,redirect,url_for
from flask_mysqldb import MySQL
from flask.templating import render_template_string
from flask.globals import request
from pip._internal import req
from test.test_contains import seq
app =Flask(__name__)


app.config["MYSQL_HOST"]="localhost"
app.config["MYSQL_USER"]="root"
app.config["MYSQL_PASSWORD"]="root"
app.config["MYSQL_DB"]="sujai"
app.config["MYSQL_CURSORCLASS"]="DictCursor"
mysql=MySQL(app)
@app.route('/')
def index():
    con = mysql.connection.cursor()
    sql ='select * from student'
    con.execute(sql)
    res=con.fetchall()
    success_message = request.args.get('success_message')
    if success_message:
        return render_template('index.html', data=res, success_message=success_message)
    else:
        return render_template('index.html', data=res)
    

#add record
@app.route('/addrecord',methods=['GET','POST'])
def addrecord():
    if(request.method=='POST'):
        roll=request.form['roll']
        name=request.form['name']
        age=request.form['age']
        gender=request.form['gender']
        email=request.form['email']
        dept=request.form['department']
        year=request.form['year']
        ph=request.form['ph']
        con=mysql.connection.cursor()
        sql="insert into student values(%s,%s,%s,%s,%s,%s,%s,%s);"
        con.execute(sql,[roll,name,age,gender,email,dept,year,ph])
        mysql.connection.commit()
        con.close()
        return redirect(url_for('index'))
    return render_template('addrecord.html')

@app.route("/edit/<string:roll>",methods=['GET','POST'])
def edit(roll):
    con=mysql.connection.cursor()
    if request.method=='POST':
        name=request.form['name']
        age=request.form['age']
        gender=request.form['gender']
        email=request.form['email']
        dept=request.form['department']
        year=request.form['year']
        ph=request.form['ph']
        upq='update student  set name=%s,age=%s,gender=%s,email_id=%s,dept=%s,year=%s,ph_no=%s where roll_no=%s'
        con.execute(upq,[name,age,gender,email,dept,year,ph,roll])
        mysql.connection.commit()
        con.close()
        return redirect(url_for('index'))
    con=mysql.connection.cursor()
    sql="select * from student where roll_no=%s"
    con.execute(sql,[roll])
    res=con.fetchone()    
    return render_template("edit.html",data =res)

@app.route('/remove/<string:roll>')
def remove(roll):
    con = mysql.connection.cursor()
    sql = 'DELETE FROM student WHERE roll_no = %s'
    con.execute(sql, [roll])
    mysql.connection.commit()
    con.close()
    success_message = "Record deleted successfully    ."
    return redirect(url_for('index', success_message=success_message))
    
if __name__ == ("__main__"):
    app.run(debug=True) 


     